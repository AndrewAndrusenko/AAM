<ng-container *ngIf="accessState!=='none'">
  <span *ngIf="!UI_min"> 
    <mat-form-field  class = "filterField" >
      <mat-label class="whiteTextFilter">Type to search...</mat-label>
      <input 
        (keyup)="applyFilter($event)"
        matInput type="text" #filter  
        matTooltip="Use context menu to add filter">
      <button matSuffix 
        mat-icon-button aria-label="Clear" 
        (click)="clearFilter(filter)">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <button color = "accent" mat-raised-button 
      style=" margin-left:1%; font-size: 18px;"
      (click)="exportToExcel()">
      Save as XLS 
      <mat-icon matSuffix >save_alt</mat-icon>
    </button>
    <button color = "accent" mat-raised-button 
      style=" margin-left:1%; font-size: 18px;"
      (click)="submitQuery()">
      Reload 
      <mat-icon matSuffix >refresh</mat-icon>
    </button>
    <p>{{action}}</p>
  </span>

  <mat-expansion-panel *ngIf="!UI_min" class="complex-search-entries" 
    (opened)="panelOpenState = true"
    (closed)="panelOpenState = false" >
    <mat-expansion-panel-header >
      <mat-panel-title 
      [style.color]="menuColorGl">
        Complex search
      </mat-panel-title>
      <mat-panel-description>
        Tap to {{panelOpenState? 'hide': 'open'}} additional parameters
        <mat-icon color = 'accent'>filter_alt</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header >
    <form class="submit" [formGroup]="searchParametersFG"  style="font-size: 18px;">
      <span style="display: flex;  justify-content: space-between;   align-items:flex-start;  margin-right: 1%;margin-top: 0.2%;">
        <span style="display:grid; width: 15%;">
          <button color = "primary" mat-raised-button style=" margin-left:1%; font-size: 18px;" (click)="submitQuery()"> Submit </button>
          <button color = "accent" mat-raised-button style=" margin-left:1%; margin-top: 2%; font-size: 18px;" (click)="searchParametersFG.reset();
          this.accounts=['ClearAll']"> ClearAll </button>
        </span>
        <mat-form-field appearance="fill">
          <mat-label>Enter a date range</mat-label>
          <mat-date-range-input [formGroup]="dataRange" [rangePicker]="picker" >
            <input matStartDate placeholder="Start date" formControlName="dateRangeStart">
            <input matEndDate placeholder="End date" formControlName="dateRangeEnd">
          </mat-date-range-input>
          <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
          <mat-error *ngIf="dataRange.controls.dateRangeStart.hasError('matStartDateInvalid')">Invalid start date</mat-error>
          <mat-error *ngIf="dataRange.controls.dateRangeEnd.hasError('matEndDateInvalid')">Invalid end date</mat-error>
        </mat-form-field>
        <mat-form-field class="example-chip-list" appearance="fill" style="width: 45%; ">
          <mat-chip-list #chipList aria-label="Fruit selection"  >
            <mat-chip *ngFor="let account of accounts" (removed)="remove(account)" (click)=" clearAll($event);"> 
              {{account}}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip>
            <input 
              placeholder="Add account or account,account1,account2.."
              formControlName="noAccountLedger"
              [matChipInputFor]="chipList"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              [matChipInputAddOnBlur]="addOnBlur"
              (matChipInputTokenEnd)="add($event)"
              matTooltip="Type account number or paste accounts list separated by comma and press enter" >
            <button style="font-size: 16px;" mat-raised-button matSuffix (click)="selectAccounts('ledger')">
              <mat-icon *ngIf="action!=='View'" class = "icon_search">search</mat-icon> MultiSelect 
            </button>
          </mat-chip-list>
        </mat-form-field>
        <mat-form-field  style="width: 18%;">
          <mat-label>Transaction Type Code</mat-label>
          <mat-select  #t_XactTypeCode_Ext formControlName="entryType"  multiple> 
            <mat-option #allSelected [value]="0"
              (click)="toggleAllSelection()" >
              ALL - {{this.allSelected.selected? 'Clear' :'Select' }} All 
            </mat-option>
            <ng-container *ngFor="let TransactionType of TransactionTypes">
            <mat-option [value]="TransactionType.id">
                {{TransactionType.xActTypeCode_Ext |uppercase}} - {{TransactionType.description}}
            </mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>
      </span>
    </form>
  </mat-expansion-panel>
  <div class="mat-elevation-z8">
    <table  #strategyTable mat-table [dataSource]="dataSource" multiTemplateDataRows matSort class="mat-elevation-z8">
      <ng-container  matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay; let i=index">
        <th mat-header-cell *matHeaderCellDef mat-sort-header >   
          <span [ngSwitch]="column">
            <p style="color: rgb(198, 255, 215);" *ngSwitchCase="'t_dataTime'">
              {{columnsHeaderToDisplay[i]  | titlecase}} 
            </p>
            <p *ngSwitchDefault>
              {{columnsHeaderToDisplay[i] }} 
            </p>
          </span>
        </th>
        <td  mat-cell *matCellDef="let element" [cdkContextMenuTriggerFor]="instrumentcontextmenu" > 
          <span [ngSwitch]="column">
            <p *ngSwitchCase="'t_id'">
              <button mat-stroked-button style="font-size: 18px; margin-top: 3%; min-width: 70%;"  matTooltip="Entry details"
              [style.background-color] =  "investmentNodeColor"
              (click)="openEntryModifyForm(element.t_dataTime<FirstOpenedAccountingDate||disabledControlElements? 'View': 'Edit', element)">
                {{element[column]}}
              </button> 
            </p>
            <p  *ngSwitchCase="'t_dataTime'">
              {{element[column] | date}} 
            </p>
            <p  *ngSwitchCase="'t_XactTypeCode'">
              {{ element[column]==0?  'Both' :  element[column]==1?  'Debit' : 'Credit'}}
            </p>
            <p *ngSwitchCase="'t_amountTransaction'">
              {{element[column] | currency}} 
            </p>
            <p *ngSwitchDefault>
              {{element[column]}}  
            </p>
          </span>
          <ng-template  #instrumentcontextmenu>
            <div class="tree-menu-context" *ngIf="!disabledControlElements" cdkMenu >
              <ng-container *ngIf="!UI_min">
                <button 
                  (click)="openEntryModifyForm('Create', element)"
                  class="tree-menu-item" cdkMenuItem >
                  <mat-icon class="menu-icon" matPrefix>add_circle</mat-icon>      
                  New Entry Account-Ledger
                </button>
                <button 
                  (click)="openEntryModifyForm('CreateLL', element)"
                  class="tree-menu-item" cdkMenuItem >
                  <mat-icon class="menu-icon" matPrefix>add_circle</mat-icon>      
                  New Entry Ledger-Ledger
                </button>
                <button 
                  (click)="openEntryModifyForm('Create_Example', element)"
                  class="tree-menu-item" cdkMenuItem >
                  <mat-icon class="menu-icon" matPrefix>add_circle</mat-icon>      
                  New Entry (on sample)
                </button>
              </ng-container>
              <button *ngIf="!(element.t_dataTime<FirstOpenedAccountingDate)"
                (click)="openEntryModifyForm('Edit', element)"
                class="tree-menu-item" cdkMenuItem>
                <mat-icon class="menu-icon" matPrefix>edit</mat-icon>      
                Edit Entry
              </button>
              <button *ngIf="!(element.t_dataTime<FirstOpenedAccountingDate)"
                (click)="openEntryModifyForm('Delete', element)"
                class="tree-menu-item" cdkMenuItem>
                <mat-icon class="menu-icon" matPrefix>delete</mat-icon> 
                Delete Entry
              </button> 
              <button *ngIf="(element.t_dataTime<FirstOpenedAccountingDate)"
                (click)="openEntryModifyForm('View', element)"
                class="tree-menu-item" cdkMenuItem>
                <mat-icon class="menu-icon" matPrefix>pageview</mat-icon> 
                View entry (day is closed)
              </button> 
              <ng-container *ngIf="!UI_min">
                <button 
                  (click)="updateFilter(element[column])"
                  class="tree-menu-item" cdkMenuItem>
                  <mat-icon class="menu-icon" matPrefix>filter_list</mat-icon> 
                  Add to filter
                </button> 
                <button 
                  (click)="addChips( element[column], column)"
                  class="tree-menu-item" cdkMenuItem>
                  <mat-icon class="menu-icon" matPrefix>filter_alt</mat-icon> 
                  ComplexFilter
                </button> 
              </ng-container>
            </div>
          </ng-template>   
        </td>
      </ng-container>
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions" mat-sort-header></th>
        <td mat-cell *matCellDef="let element" style="width:10%">
          <button  *ngIf="element.t_dataTime<FirstOpenedAccountingDate||disabledControlElements" mat-icon-button 
            aria-label="expand row" color="accent"
            mat-icon-button aria-label="expand row" color="accent"
            matTooltip="View entry (day is closed)"
            (click)="openEntryModifyForm('View', element)">
            <mat-icon >pageview</mat-icon>
          </button>
          <ng-container *ngIf="!disabledControlElements">
            <button  *ngIf="element.t_dataTime>FirstOpenedAccountingDate ||element.t_dataTime==FirstOpenedAccountingDate" 
              mat-icon-button 
              aria-label="expand row" color="accent"
              matTooltip="Edit entry"
              (click)="openEntryModifyForm('Edit', element)">
              <mat-icon >edit</mat-icon>
            </button>
            <button *ngIf="element.t_dataTime>FirstOpenedAccountingDate ||element.t_dataTime==FirstOpenedAccountingDate" 
              mat-icon-button 
              style="margin-left: 5%;" aria-label="expand row" color="accent" 
              matTooltip="Delete entry"
              (click)="openEntryModifyForm('Delete', element)">
              <mat-icon >delete</mat-icon>
            </button>
          </ng-container>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
      <tr mat-row  *matRowDef="let element; columns: columnsToDisplayWithExpand;"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="20" aria-label="Select page of users"></mat-paginator>
  </div>
</ng-container>